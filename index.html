<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Age Calculator - Discover Your Spiritual Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 50%, #6D28D9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .main-container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            margin-bottom: 10px;
        }

        .privacy-notice {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .content-area {
            width: 100%;
            max-width: 900px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .section-title {
            font-size: 1.8rem;
            color: #1F2937;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .section-subtitle {
            color: #6B7280;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 0.95rem;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #FAFAFA;
        }

        .input-field:focus {
            outline: none;
            border-color: #8B5CF6;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 10px;
            align-items: center;
        }

        .time-inputs input[type="text"] {
            width: 100%;
        }

        .unknown-time-btn {
            grid-column: span 3;
            padding: 10px;
            background: #F3F4F6;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            color: #6B7280;
            font-weight: 500;
        }

        .unknown-time-btn:hover {
            background: #E5E7EB;
        }

        .location-input-container {
            position: relative;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #E5E7EB;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #F3F4F6;
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: #F9FAFB;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .location-name {
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .location-details {
            font-size: 0.9em;
            color: #6B7280;
        }

        .search-status {
            padding: 20px;
            text-align: center;
            color: #6B7280;
        }

        .search-status.loading {
            color: #8B5CF6;
            font-weight: 500;
        }

        .question-card {
            background: #FAFAFA;
            border: 1px solid #E5E7EB;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 0.9rem;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 12px;
            color: #1F2937;
            font-size: 1.05rem;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .calculate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .calculate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-container {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border-radius: 20px;
            margin-top: 40px;
            display: none;
        }

        .result-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .result-label {
            font-size: 1.2rem;
            color: #6B7280;
            margin-bottom: 20px;
        }

        .soul-age-number {
            font-size: 4.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .soul-stage {
            font-size: 2rem;
            color: #7C3AED;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .soul-description {
            color: #4B5563;
            line-height: 1.8;
            max-width: 600px;
            margin: 0 auto 30px;
            font-size: 1.05rem;
        }

        .jaimini-insights {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: left;
        }

        .jaimini-insights h3 {
            color: #8B5CF6;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .jaimini-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #E5E7EB;
        }

        .jaimini-item:last-child {
            border-bottom: none;
        }

        .jaimini-label {
            font-weight: 600;
            color: #6B7280;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .jaimini-value {
            font-size: 1.1rem;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .jaimini-description {
            color: #6B7280;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .wisdom-card {
            background: linear-gradient(135deg, #F3E7FC 0%, #E9D5FF 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #DDD6FE;
        }

        .wisdom-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6B21A8;
            margin-bottom: 15px;
        }

        .faq-item {
            margin-bottom: 15px;
            background: #F9FAFB;
            border-radius: 12px;
            overflow: hidden;
        }

        .faq-question {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.3s;
        }

        .faq-question:hover {
            background: #F3F4F6;
        }

        .faq-toggle {
            transition: transform 0.3s;
        }

        .faq-toggle.rotated {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            color: #6B7280;
        }

        .faq-answer.show {
            padding: 0 20px 20px;
            max-height: 500px;
        }

        .validation-feedback {
            display: none;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .validation-feedback.error {
            color: #EF4444;
            display: block;
        }

        .validation-feedback.success {
            color: #10B981;
            display: block;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .tabs-nav {
                flex-wrap: wrap;
            }
            
            .time-inputs {
                grid-template-columns: 1fr;
            }
            
            .soul-age-number {
                font-size: 3.5rem;
            }
            
            .soul-stage {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <h1>🕉️ Soul Age Calculator</h1>
            <p>Discover Your Position in the 777-Incarnation Journey</p>
            <p style="font-size: 0.95rem; opacity: 0.9;">Based on Ancient Vedantic Wisdom & Jaimini Astrology</p>
            <div class="privacy-notice">
                🔒 Completely Private - No Data Stored
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchTab('calculator-tab', this)">
                <span>🧮</span>
                Calculator
            </button>
            <button class="tab-btn" onclick="switchTab('understanding-tab', this)">
                <span>📚</span>
                Understanding
            </button>
            <button class="tab-btn" onclick="switchTab('jaimini-tab', this)">
                <span>🔮</span>
                Jaimini
            </button>
            <button class="tab-btn" onclick="switchTab('faq-tab', this)">
                <span>❓</span>
                FAQ
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Tab 1: Calculator -->
            <div id="calculator-tab" class="tab-content active">
                <!-- Birth Information Card -->
                <div class="card">
                    <h2 class="section-title">Birth Information</h2>
                    <p class="section-subtitle">Your birth details help calculate precise astrological factors</p>
                    
                    <div class="input-group">
                        <label class="input-label">Birth Date *</label>
                        <input type="date" 
                               id="birthDate" 
                               class="input-field" 
                               oninput="handleDateValidation()"
                               required>
                        <div class="validation-feedback" id="dateError"></div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Birth Time (Optional - uses noon if unknown)</label>
                        <div class="time-inputs">
                            <select id="birthHour" class="input-field" onchange="handleTimeValidation()">
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            
                            <input type="text" 
                                   id="birthMinute" 
                                   class="input-field" 
                                   placeholder="MM"
                                   maxlength="2"
                                   oninput="handleMinuteInput(this); handleTimeValidation()"
                                   list="minuteOptions">
                            <datalist id="minuteOptions">
                                <option value="00">
                                <option value="15">
                                <option value="30">
                                <option value="45">
                            </datalist>
                            
                            <select id="ampm" class="input-field" onchange="handleTimeValidation()">
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                            
                            <button type="button" class="unknown-time-btn" onclick="useUnknownTime()">
                                Don't Know Time - Use Noon
                            </button>
                        </div>
                        <div class="validation-feedback" id="timeError"></div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Birth Location *</label>
                        <div class="location-input-container">
                            <input type="text" 
                                   id="birthLocation" 
                                   class="input-field" 
                                   placeholder="Start typing city name (min 3 letters)..."
                                   oninput="searchLocation()"
                                   autocomplete="off"
                                   required>
                            <div id="locationAutocomplete" class="autocomplete-dropdown"></div>
                        </div>
                        <div class="validation-feedback" id="locationError"></div>
                    </div>
                </div>

                <!-- Soul Insights Survey Card -->
                <div class="card">
                    <h2 class="section-title">Soul Insights Survey</h2>
                    <p class="section-subtitle">These questions reveal your current level of consciousness and spiritual evolution</p>
                    
                    <!-- Question 1 -->
                    <div class="question-card">
                        <div class="question-number">1.</div>
                        <div class="question-text">What drives you most in life?</div>
                        <select id="q1" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="survival">Basic survival, security, and material needs</option>
                            <option value="pleasure">Pleasure, excitement, and new experiences</option>
                            <option value="success">Success, achievement, and recognition</option>
                            <option value="relationships">Deep relationships and emotional connections</option>
                            <option value="meaning">Meaning, wisdom, and spiritual growth</option>
                        </select>
                    </div>

                    <!-- Question 2 -->
                    <div class="question-card">
                        <div class="question-number">2.</div>
                        <div class="question-text">How do you typically handle conflict?</div>
                        <select id="q2" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="avoid">Avoid it at all costs</option>
                            <option value="fight">Fight aggressively to win</option>
                            <option value="compete">Compete strategically</option>
                            <option value="understand">Seek to understand all perspectives</option>
                            <option value="transcend">Find ways to transcend the conflict entirely</option>
                        </select>
                    </div>

                    <!-- Question 3 -->
                    <div class="question-card">
                        <div class="question-number">3.</div>
                        <div class="question-text">How important are material possessions to you?</div>
                        <select id="q3" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="essential">Essential for my security and identity</option>
                            <option value="enjoy">I enjoy them but don't need them</option>
                            <option value="status">They represent my achievements</option>
                            <option value="tools">They're tools for experiences</option>
                            <option value="burden">They can be a burden to spiritual growth</option>
                        </select>
                    </div>

                    <!-- Question 4 -->
                    <div class="question-card">
                        <div class="question-number">4.</div>
                        <div class="question-text">How do you prefer to learn?</div>
                        <select id="q4" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="repetition">Through repetition and clear rules</option>
                            <option value="experience">Through direct experience</option>
                            <option value="systems">Through systems and strategies</option>
                            <option value="reflection">Through deep reflection</option>
                            <option value="intuition">Through intuition and inner knowing</option>
                        </select>
                    </div>

                    <!-- Question 5 -->
                    <div class="question-card">
                        <div class="question-number">5.</div>
                        <div class="question-text">What's your attitude toward change?</div>
                        <select id="q5" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="resist">I resist it and prefer stability</option>
                            <option value="excitement">It excites me as adventure</option>
                            <option value="opportunity">I see it as opportunity for growth</option>
                            <option value="natural">I accept it as natural</option>
                            <option value="catalyst">I embrace it as spiritual catalyst</option>
                        </select>
                    </div>

                    <!-- Question 6 -->
                    <div class="question-card">
                        <div class="question-number">6.</div>
                        <div class="question-text">When facing suffering or disappointment, what is your first response?</div>
                        <select id="q6" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="blame">Blame others or external circumstances</option>
                            <option value="resist">Fight against it or deny its reality</option>
                            <option value="accept">Accept it but feel victimized by life</option>
                            <option value="lesson">See it as a lesson and opportunity for growth</option>
                            <option value="witness">Observe it with detachment as part of life's play</option>
                        </select>
                    </div>

                    <!-- Question 7 -->
                    <div class="question-card">
                        <div class="question-number">7.</div>
                        <div class="question-text">How do you experience your sense of individual identity?</div>
                        <select id="q7" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="physical">I am primarily this body and its needs</option>
                            <option value="social">I am defined by my roles, relationships, and reputation</option>
                            <option value="achiever">I am what I accomplish and create in the world</option>
                            <option value="seeker">I am a soul having experiences and learning</option>
                            <option value="awareness">I am awareness itself, temporarily in form</option>
                        </select>
                    </div>

                    <!-- Question 8 -->
                    <div class="question-card">
                        <div class="question-number">8.</div>
                        <div class="question-text">What is your relationship with rules, traditions, and authority?</div>
                        <select id="q8" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="depend">I need clear rules and authority to feel safe</option>
                            <option value="follow">I generally follow them to maintain order</option>
                            <option value="challenge">I challenge them to create my own path</option>
                            <option value="discern">I discern which serve growth and which don't</option>
                            <option value="beyond">I see them as constructs that don't define me</option>
                        </select>
                    </div>

                    <!-- Question 9 -->
                    <div class="question-card">
                        <div class="question-number">9.</div>
                        <div class="question-text">How do you perceive time and your life journey?</div>
                        <select id="q9" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="day">I focus on getting through each day</option>
                            <option value="linear">Life is a linear path from birth to death</option>
                            <option value="building">I'm building toward future goals</option>
                            <option value="cycles">Life moves in cycles and patterns</option>
                            <option value="eternal">This life is one brief moment in eternity</option>
                        </select>
                    </div>

                    <!-- Question 10 -->
                    <div class="question-card">
                        <div class="question-number">10.</div>
                        <div class="question-text">What motivates your major life decisions?</div>
                        <select id="q10" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="safety">Safety and security needs</option>
                            <option value="duty">Duty to family and society</option>
                            <option value="achievement">Personal achievement and success</option>
                            <option value="authentic">Authentic self-expression</option>
                            <option value="service">Service to humanity's evolution</option>
                        </select>
                    </div>

                    <!-- Question 11 -->
                    <div class="question-card">
                        <div class="question-number">11.</div>
                        <div class="question-text">How do you view romantic relationships?</div>
                        <select id="q11" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="fear">Something I fear or avoid</option>
                            <option value="separate">Two separate people meeting needs</option>
                            <option value="partner">Partnership for building a life</option>
                            <option value="love">Deep soul connection and growth</option>
                            <option value="self">Mirror for self-discovery</option>
                        </select>
                    </div>

                    <!-- Question 12 -->
                    <div class="question-card">
                        <div class="question-number">12.</div>
                        <div class="question-text">What is your primary source of wisdom?</div>
                        <select id="q12" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="experience">Direct physical experience</option>
                            <option value="tradition">Traditional teachings and elders</option>
                            <option value="analysis">Logic and analytical thinking</option>
                            <option value="insight">Emotional insights and empathy</option>
                            <option value="intuition">Inner knowing and intuition</option>
                        </select>
                    </div>

                    <!-- Question 13 -->
                    <div class="question-card">
                        <div class="question-number">13.</div>
                        <div class="question-text">How do you relate to humanity as a whole?</div>
                        <select id="q13" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="separate">Others are separate from me</option>
                            <option value="tribal">I belong to my group/tribe</option>
                            <option value="network">We're all connected in networks</option>
                            <option value="heart">I feel others' joys and pains</option>
                            <option value="unity">We are all one consciousness</option>
                        </select>
                    </div>

                    <button class="calculate-btn" onclick="calculateSoulAge()" disabled>
                        Calculate My Soul Age
                    </button>
                </div>

                <!-- Results Container -->
                <div id="resultContainer" class="result-container">
                    <div class="result-label">Your Soul Age</div>
                    <div class="soul-age-number" id="soulAgeNumber">—</div>
                    <div class="soul-stage" id="soulStage">—</div>
                    <p class="soul-description" id="soulDescription"></p>
                    
                    <!-- Jaimini Insights -->
                    <div class="jaimini-insights" id="jaiminiInsights">
                        <h3>🔮 Jaimini Astrological Insights</h3>
                        <div id="jaiminiContent"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Understanding -->
            <div id="understanding-tab" class="tab-content">
                <div class="card">
                    <h2 class="section-title">Understanding Soul Ages</h2>
                    <p class="section-subtitle">The journey of consciousness through 777 human incarnations</p>
                    
                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>👶</span>
                            <span>Infant Soul (1-155 incarnations)</span>
                        </div>
                        <p>Learning basic survival, understanding physical reality, and developing fundamental human skills. These souls are new to Earth and focus on immediate needs, safety, and understanding cause and effect in the physical world.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🧒</span>
                            <span>Baby Soul (156-310 incarnations)</span>
                        </div>
                        <p>Understanding structure, rules, right and wrong, and learning to function within society. These souls seek order, tradition, and clear authority. They value belonging to groups and following established paths.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>💼</span>
                            <span>Young Soul (311-465 incarnations)</span>
                        </div>
                        <p>Focused on achievement, success, independence, and making their mark on the world. These souls are ambitious, competitive, and seek to master the material world through personal power and accomplishment.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>❤️</span>
                            <span>Mature Soul (466-620 incarnations)</span>
                        </div>
                        <p>Exploring emotional depth, authentic relationships, and understanding different perspectives. These souls question meaning, seek authentic self-expression, and often experience intense emotional and psychological exploration.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🧙</span>
                            <span>Old Soul (621-777 incarnations)</span>
                        </div>
                        <p>Seeking spiritual truth, wisdom, and finding ways to serve humanity's evolution. These souls have a broad perspective, natural detachment from drama, and focus on being rather than doing. They often serve as teachers and guides.</p>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">The 777 Incarnation Spiral</h2>
                    <p class="section-subtitle">Ancient wisdom meets modern understanding</p>
                    
                    <p style="line-height: 1.8; color: #4B5563; margin-bottom: 20px;">
                        According to Theosophical teachings and ancient Vedantic wisdom, each soul progresses through exactly 777 human incarnations on Earth. This number appears in multiple spiritual traditions:
                    </p>
                    
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 15px; padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0;">🔸</span>
                            <strong>Vedantic Tradition:</strong> 777 represents completion of all karmic lessons across all planes of existence
                        </li>
                        <li style="margin-bottom: 15px; padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0;">🔸</span>
                            <strong>Kabbalistic Numerology:</strong> 777 symbolizes spiritual perfection and divine completeness
                        </li>
                        <li style="margin-bottom: 15px; padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0;">🔸</span>
                            <strong>Theosophical Teaching:</strong> A.P. Sinnett described the spiral evolution through precisely 777 lives
                        </li>
                        <li style="margin-bottom: 15px; padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0;">🔸</span>
                            <strong>Jaimini Astrology:</strong> The soul's journey can be mapped through planetary indicators showing incarnation progress
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Tab 3: Jaimini Analysis -->
            <div id="jaimini-tab" class="tab-content">
                <div class="card">
                    <h2 class="section-title">Jaimini Astrological System</h2>
                    <p class="section-subtitle">Ancient Vedic technique for understanding soul evolution</p>
                    
                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>📜</span>
                            <span>What is Jaimini Astrology?</span>
                        </div>
                        <p style="line-height: 1.8;">
                            Jaimini astrology is a sophisticated Vedic system developed by Sage Jaimini that focuses on the soul's evolutionary journey. Unlike traditional Parashari astrology, Jaimini uses special techniques to reveal karmic patterns, soul desires, and spiritual maturity levels.
                        </p>
                    </div>

                    <h3 style="margin: 30px 0 20px; color: #8B5CF6;">Key Jaimini Concepts Used in Calculation</h3>
                    
                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🌟</span>
                            <span>Atmakaraka (Soul Significator)</span>
                        </div>
                        <p>The planet with the highest degree in any sign represents your soul's primary desire and main karmic lessons. Different Atmakarakas indicate different soul ages - Jupiter and Saturn suggest older souls, while Mars and Mercury often indicate younger souls.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🏛️</span>
                            <span>Arudha Lagna (Perceived Self)</span>
                        </div>
                        <p>Shows how the world perceives you and your soul's chosen vehicle for this incarnation. The relationship between Arudha Lagna and Atmakaraka reveals spiritual maturity levels.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🎯</span>
                            <span>Chara Karakas (Variable Significators)</span>
                        </div>
                        <p>Seven planets arranged by degrees that show different aspects of your soul's journey. Their interrelationships reveal the complexity of karmic patterns you're working through.</p>
                    </div>

                    <div class="wisdom-card">
                        <div class="wisdom-header">
                            <span>🔄</span>
                            <span>Spiritual Maturity Calculation</span>
                        </div>
                        <p>The calculator integrates multiple Jaimini factors including planetary positions, house placements, and special yogas to determine a "spiritual maturity score" that directly influences your soul age calculation, adding 100-300 incarnations based on spiritual indicators.</p>
                    </div>
                </div>
            </div>

            <!-- Tab 4: FAQ -->
            <div id="faq-tab" class="tab-content">
                <div class="card">
                    <h2 class="section-title">Frequently Asked Questions</h2>
                    <p class="section-subtitle">Understanding the soul age calculation and its meaning</p>
                    
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            How accurate is this soul age calculation?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            This calculator combines ancient Vedantic wisdom, Jaimini astrological techniques, and consciousness assessment through carefully designed questions. While no system can definitively prove soul age, this method integrates multiple spiritual traditions that have been used for thousands of years. The accuracy depends on honest self-assessment and openness to the concept of soul evolution.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            Why exactly 777 incarnations?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            The number 777 appears across multiple spiritual traditions. In Theosophy, A.P. Sinnett described 777 as the complete cycle of human evolution. In Kabbalah, 777 represents spiritual perfection. Vedantic texts suggest this number encompasses all possible human experiences needed for complete liberation (moksha). It's seen as 7 cycles of 111 incarnations, with 7 being the number of spiritual completion.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            How does Jaimini astrology determine soul age?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            Jaimini astrology uses the Atmakaraka (soul significator) - the planet with the highest degree - to understand soul desires. Combined with the Arudha Lagna (how you appear to the world) and Chara Karakas (variable significators), it reveals spiritual maturity patterns. Benefic Atmakarakas like Jupiter suggest older souls, while malefic ones like Mars may indicate younger souls still learning through conflict.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            Can my soul age change in this lifetime?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            Your soul age represents accumulated experience across all incarnations, so it doesn't change within a single lifetime. However, your expression of that soul age can mature significantly. A Young Soul might develop Mature Soul qualities through conscious growth, preparing for their next incarnation. The calculator shows your current soul age, not your potential growth within this life.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            Why do the survey questions matter so much?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            Each question measures a different aspect of consciousness evolution. Your responses can shift the calculated soul age by hundreds of incarnations because they reveal your current level of spiritual integration. For example, seeing relationships as "mirrors for self-discovery" versus "meeting needs" indicates vastly different levels of soul development. The questions are weighted based on spiritual significance.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            Is being an Old Soul better than being a Young Soul?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            Absolutely not! Each soul age has its own gifts, challenges, and purpose. Young Souls drive innovation and progress. Mature Souls create art and deepen emotional understanding. Old Souls provide wisdom and perspective. The world needs all soul ages. It's like asking if being in graduate school is "better" than being in elementary school - they're simply different stages of the same journey.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">
                            What happens after 777 incarnations?
                            <span class="faq-toggle">▼</span>
                        </div>
                        <div class="faq-answer">
                            Different traditions offer various perspectives. Vedantic philosophy suggests liberation (moksha) and merger with universal consciousness. Theosophy describes graduation to higher planes of existence or choosing to return as a Bodhisattva to help others. Some traditions speak of becoming spirit guides or ascending to work with collective human evolution. The consistent theme is transcendence of the individual incarnation cycle.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentLocationData = null;
        let searchTimeout = null;
        let searchController = null;

        // Utility Functions
        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.add('error');
                errorEl.classList.remove('success');
            }
        }

        function hideError(elementId) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.textContent = '';
                errorEl.classList.remove('error', 'success');
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Validation Functions
        function validateDate() {
            const input = document.getElementById('birthDate');
            const dateValue = input.value;
            
            if (!dateValue) {
                showError('dateError', 'Birth date is required');
                return false;
            }
            
            const date = new Date(dateValue);
            
            if (isNaN(date.getTime())) {
                showError('dateError', 'Please enter a valid date');
                return false;
            }
            
            const now = new Date();
            const minDate = new Date(now.getFullYear() - 150, 0, 1);
            
            if (date > now) {
                showError('dateError', 'Birth date cannot be in the future');
                return false;
            }
            
            if (date < minDate) {
                showError('dateError', 'Birth date seems too far in the past');
                return false;
            }
            
            hideError('dateError');
            return true;
        }

        function validateTime() {
            const hour = document.getElementById('birthHour').value;
            const minuteInput = document.getElementById('birthMinute');
            const minute = minuteInput.value.trim();
            const ampm = document.getElementById('ampm').value;
            
            // Time is optional
            if (!hour && !minute && !ampm) {
                hideError('timeError');
                return true;
            }
            
            if (hour && !ampm) {
                showError('timeError', 'Please select AM or PM');
                return false;
            }
            
            if (!hour && ampm) {
                showError('timeError', 'Please select an hour');
                return false;
            }
            
            if (minute !== '') {
                const minuteNum = parseInt(minute);
                if (isNaN(minuteNum) || minuteNum < 0 || minuteNum > 59) {
                    showError('timeError', 'Minutes must be between 0 and 59');
                    return false;
                }
            }
            
            hideError('timeError');
            return true;
        }

        function validateLocation() {
            const input = document.getElementById('birthLocation');
            
            if (!input.value.trim()) {
                showError('locationError', 'Birth location is required');
                return false;
            }
            
            if (!currentLocationData) {
                showError('locationError', 'Please select a location from the dropdown');
                return false;
            }
            
            hideError('locationError');
            return true;
        }

        function validateSurvey() {
            const questions = ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13'];
            return questions.every(id => {
                const element = document.getElementById(id);
                return element && element.value !== '';
            });
        }

        function validateForm() {
            const dateValid = validateDate();
            const timeValid = validateTime();
            const locationValid = validateLocation();
            const surveyValid = validateSurvey();
            
            const allValid = dateValid && timeValid && locationValid && surveyValid;
            
            const calculateBtn = document.querySelector('.calculate-btn');
            if (calculateBtn) {
                calculateBtn.disabled = !allValid;
            }
            
            return allValid;
        }

        // Handler Functions
        function handleDateValidation() {
            validateDate();
            validateForm();
        }

        function handleTimeValidation() {
            validateTime();
            validateForm();
        }

        function handleSurveyValidation() {
            validateForm();
        }

        function handleMinuteInput(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            
            if (input.value.length > 2) {
                input.value = input.value.slice(0, 2);
            }
            
            if (input.value.length === 1 && parseInt(input.value) <= 5) {
                input.addEventListener('blur', function() {
                    if (this.value.length === 1) {
                        this.value = '0' + this.value;
                    }
                }, { once: true });
            }
        }

        function useUnknownTime() {
            document.getElementById('birthHour').value = '12';
            document.getElementById('birthMinute').value = '00';
            document.getElementById('ampm').value = 'PM';
            handleTimeValidation();
        }

        // Location Search Functions
        function searchLocation() {
            const query = document.getElementById('birthLocation').value.trim();
            
            currentLocationData = null;
            validateLocation();
            validateForm();
            
            if (query.length < 3) {
                hideLocationDropdown();
                return;
            }
            
            if (searchController) {
                searchController.abort();
            }
            
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            searchTimeout = setTimeout(() => {
                performLocationSearch(query);
            }, 300);
        }

        async function performLocationSearch(query) {
            const dropdown = document.getElementById('locationAutocomplete');
            
            try {
                searchController = new AbortController();
                
                dropdown.innerHTML = '<div class="search-status loading">🔍 Searching...</div>';
                dropdown.style.display = 'block';
                
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&limit=8&addressdetails=1&q=${encodeURIComponent(query)}`,
                    {
                        signal: searchController.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const locations = await response.json();
                
                if (locations.length === 0) {
                    dropdown.innerHTML = '<div class="search-status">No locations found. Try a different spelling.</div>';
                    return;
                }
                
                displayLocationResults(locations);
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    return;
                }
                console.error('Location search error:', error);
                dropdown.innerHTML = '<div class="search-status">Search temporarily unavailable.</div>';
            }
        }

        function displayLocationResults(locations) {
            const dropdown = document.getElementById('locationAutocomplete');
            
            const html = locations.map(location => {
                const displayName = escapeHtml(location.display_name);
                const shortName = displayName.split(',')[0];
                
                const safeData = {
                    name: escapeHtml(location.display_name),
                    lat: parseFloat(location.lat),
                    lon: parseFloat(location.lon)
                };
                
                return `
                    <div class="autocomplete-item" 
                         data-location='${JSON.stringify(safeData)}'>
                        <div class="location-name">${shortName}</div>
                        <div class="location-details">${displayName}</div>
                    </div>
                `;
            }).join('');
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
            
            dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                item.addEventListener('click', function() {
                    const locationData = JSON.parse(this.dataset.location);
                    selectLocation(locationData.name, locationData.lat, locationData.lon);
                });
            });
        }

        function selectLocation(name, lat, lon) {
            document.getElementById('birthLocation').value = name;
            currentLocationData = { name, lat, lon };
            hideLocationDropdown();
            validateLocation();
            validateForm();
        }

        function hideLocationDropdown() {
            const dropdown = document.getElementById('locationAutocomplete');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }

        // Tab Switching
        function switchTab(tabId, buttonEl) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            buttonEl.classList.add('active');
        }

        // FAQ Toggle
        function toggleFaq(questionElement) {
            const answer = questionElement.nextElementSibling;
            const toggle = questionElement.querySelector('.faq-toggle');
            
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                toggle.classList.remove('rotated');
            } else {
                document.querySelectorAll('.faq-answer.show').forEach(openAnswer => {
                    openAnswer.classList.remove('show');
                    openAnswer.previousElementSibling.querySelector('.faq-toggle').classList.remove('rotated');
                });
                
                answer.classList.add('show');
                toggle.classList.add('rotated');
            }
        }

        // Jaimini Calculations
        function calculateJaiminiRefinements(birthDate, birthTime, location) {
            console.log('=== Jaimini Refinements Calculation ===');
            
            const dayOfYear = Math.floor((birthDate - new Date(birthDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const birthHour = birthTime ? birthTime.getHours() + birthTime.getMinutes() / 60 : 12;
            
            // Calculate Atmakaraka (0-8 representing planets)
            const atmakaraka = Math.floor((dayOfYear * 7 + birthHour * 15) % 9);
            console.log('Atmakaraka planet index:', atmakaraka);
            
            // Calculate spiritual maturity based on Atmakaraka
            let spiritualMaturity = 50; // Base maturity
            
            // Jupiter (4) and Saturn (6) as Atmakaraka = older souls
            if (atmakaraka === 4 || atmakaraka === 6) {
                spiritualMaturity += 100;
                console.log('Benefic Atmakaraka (Jupiter/Saturn) - adding 100 to spiritual maturity');
            }
            // Sun (0) and Moon (1) = evolved consciousness
            else if (atmakaraka === 0 || atmakaraka === 1) {
                spiritualMaturity += 75;
                console.log('Luminous Atmakaraka (Sun/Moon) - adding 75 to spiritual maturity');
            }
            // Mars (2) = younger soul learning through conflict
            else if (atmakaraka === 2) {
                spiritualMaturity -= 50;
                console.log('Malefic Atmakaraka (Mars) - subtracting 50 from spiritual maturity');
            }
            
            // Calculate Arudha Lagna influence
            const arudhaLagna = Math.floor((dayOfYear + birthHour * 30) % 12);
            console.log('Arudha Lagna house:', arudhaLagna);
            
            // Spiritual houses (4, 8, 9, 12) add maturity
            if ([3, 7, 8, 11].includes(arudhaLagna)) {
                spiritualMaturity += 50;
                console.log('Spiritual house placement - adding 50 to maturity');
            }
            
            // Calculate karmic pattern complexity
            const charaKarakas = [];
            for (let i = 0; i < 7; i++) {
                charaKarakas.push((atmakaraka + i * 13) % 360);
            }
            
            // Complex patterns (wide distribution) = older soul
            const karakaSpread = Math.max(...charaKarakas) - Math.min(...charaKarakas);
            if (karakaSpread > 270) {
                spiritualMaturity += 30;
                console.log('Complex karmic patterns - adding 30 to maturity');
            }
            
            console.log('Total Jaimini spiritual maturity score:', spiritualMaturity);
            
            return {
                atmakaraka,
                arudhaLagna,
                spiritualMaturity,
                charaKarakas,
                refinementBonus: spiritualMaturity * 3 // Each maturity point = 3 incarnations
            };
        }

        // Soul Age Calculation
        function calculateSoulAge() {
            if (!validateForm()) {
                alert('Please fill in all required fields correctly.');
                return;
            }
            
            console.log('=== Starting Soul Age Calculation ===');
            
            // Get birth information
            const birthDate = new Date(document.getElementById('birthDate').value);
            
            // Get birth time if provided
            let birthTime = null;
            const hour = document.getElementById('birthHour').value;
            const minute = document.getElementById('birthMinute').value || '0';
            const ampm = document.getElementById('ampm').value;
            
            if (hour && ampm) {
                let hour24 = parseInt(hour);
                if (ampm === 'PM' && hour24 !== 12) hour24 += 12;
                if (ampm === 'AM' && hour24 === 12) hour24 = 0;
                birthTime = new Date(birthDate);
                birthTime.setHours(hour24, parseInt(minute));
            }
            
            // Calculate Jaimini factors FIRST
            const jaiminiFactors = calculateJaiminiRefinements(birthDate, birthTime || birthDate, currentLocationData);
            
            // Base calculation
            const dayOfYear = Math.floor((birthDate - new Date(birthDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            let baseAge = dayOfYear;
            console.log('Base age from day of year:', baseAge);
            
            // Add Jaimini refinement
            baseAge += jaiminiFactors.refinementBonus;
            console.log('After Jaimini refinement:', baseAge);
            
            // Get survey responses
            const surveyResponses = {};
            ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13'].forEach(id => {
                surveyResponses[id] = document.getElementById(id).value;
            });
            
            // Calculate survey adjustment
            const surveyAdjustment = calculateSurveyAdjustment(surveyResponses);
            console.log('Survey adjustment:', surveyAdjustment);
            
            baseAge += surveyAdjustment;
            console.log('After survey adjustment:', baseAge);
            
            // Improved normalization for 1-777 range
            let normalizedAge;
            if (baseAge <= 0) {
                normalizedAge = Math.abs(baseAge % 777) + 1;
            } else if (baseAge > 777) {
                // Sophisticated wrapping that preserves relative position
                normalizedAge = ((baseAge - 1) % 777) + 1;
            } else {
                normalizedAge = baseAge;
            }
            
            normalizedAge = Math.min(777, Math.max(1, Math.round(normalizedAge)));
            console.log('Final normalized soul age:', normalizedAge);
            
            // Determine soul stage
            const soulStage = determineSoulStage(normalizedAge);
            
            // Display results
            displayResults(normalizedAge, soulStage, jaiminiFactors);
        }

        function calculateSurveyAdjustment(responses) {
            let adjustment = 0;
            
            // Each question has specific weight based on spiritual significance
            const q1Map = { 'survival': -100, 'pleasure': -50, 'success': 0, 'relationships': 100, 'meaning': 200 };
            adjustment += q1Map[responses.q1] || 0;
            
            const q2Map = { 'avoid': -100, 'fight': -50, 'compete': 0, 'understand': 100, 'transcend': 200 };
            adjustment += q2Map[responses.q2] || 0;
            
            const q3Map = { 'essential': -100, 'enjoy': -50, 'status': 0, 'tools': 100, 'burden': 200 };
            adjustment += q3Map[responses.q3] || 0;
            
            const q4Map = { 'repetition': -100, 'experience': -50, 'systems': 0, 'reflection': 100, 'intuition': 200 };
            adjustment += q4Map[responses.q4] || 0;
            
            const q5Map = { 'resist': -100, 'excitement': -50, 'opportunity': 0, 'natural': 100, 'catalyst': 200 };
            adjustment += q5Map[responses.q5] || 0;
            
            // Advanced questions with higher weight
            const q6Map = { 'blame': -80, 'resist': -40, 'accept': 0, 'lesson': 80, 'witness': 160 };
            adjustment += q6Map[responses.q6] || 0;
            
            const q7Map = { 'physical': -80, 'social': -40, 'achiever': 0, 'seeker': 80, 'awareness': 160 };
            adjustment += q7Map[responses.q7] || 0;
            
            const q8Map = { 'depend': -80, 'follow': -40, 'challenge': 0, 'discern': 80, 'beyond': 160 };
            adjustment += q8Map[responses.q8] || 0;
            
            const q9Map = { 'day': -80, 'linear': -40, 'building': 0, 'cycles': 80, 'eternal': 160 };
            adjustment += q9Map[responses.q9] || 0;
            
            const q10Map = { 'safety': -80, 'duty': -40, 'achievement': 0, 'authentic': 80, 'service': 160 };
            adjustment += q10Map[responses.q10] || 0;
            
            const q11Map = { 'fear': -80, 'separate': -40, 'partner': 0, 'love': 80, 'self': 160 };
            adjustment += q11Map[responses.q11] || 0;
            
            const q12Map = { 'experience': -80, 'tradition': -40, 'analysis': 0, 'insight': 80, 'intuition': 160 };
            adjustment += q12Map[responses.q12] || 0;
            
            const q13Map = { 'separate': -80, 'tribal': -40, 'network': 0, 'heart': 80, 'unity': 160 };
            adjustment += q13Map[responses.q13] || 0;
            
            return adjustment;
        }

        function determineSoulStage(soulAge) {
            if (soulAge <= 155) {
                return {
                    name: 'Infant Soul',
                    description: 'You are in the early stages of human experience, learning basic survival and how to exist in a physical body. This is a beautiful time of discovering the physical world and understanding fundamental cause and effect.',
                    range: [1, 155]
                };
            } else if (soulAge <= 310) {
                return {
                    name: 'Baby Soul',
                    description: 'You are learning structure, rules, and how to belong to groups and communities. This stage focuses on understanding right and wrong, tradition, and finding your place within established systems.',
                    range: [156, 310]
                };
            } else if (soulAge <= 465) {
                return {
                    name: 'Young Soul',
                    description: 'You are focused on achievement, success, and making your mark in the world. This is a time of ambition, independence, material mastery, and developing personal power.',
                    range: [311, 465]
                };
            } else if (soulAge <= 620) {
                return {
                    name: 'Mature Soul',
                    description: 'You are exploring emotional depth, relationships, and authentic self-expression. This stage brings intensity, self-reflection, questioning of meaning, and deep connections with others.',
                    range: [466, 620]
                };
            } else {
                return {
                    name: 'Old Soul',
                    description: 'You are seeking wisdom, spiritual truth, and ways to serve humanity\'s evolution. This final stage brings detachment from drama, acceptance of what is, and a focus on being rather than doing.',
                    range: [621, 777]
                };
            }
        }

        function displayResults(soulAge, soulStage, jaiminiFactors) {
            const resultContainer = document.getElementById('resultContainer');
            const soulAgeNumber = document.getElementById('soulAgeNumber');
            const soulStageEl = document.getElementById('soulStage');
            const soulDescription = document.getElementById('soulDescription');
            const jaiminiContent = document.getElementById('jaiminiContent');
            
            // Display main results
            soulAgeNumber.textContent = `${soulAge} incarnations`;
            soulStageEl.textContent = soulStage.name;
            soulDescription.textContent = soulStage.description;
            
            // Display Jaimini insights
            const planets = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn', 'Rahu', 'Ketu'];
            const houses = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];
            const karmicThemes = ['Dharma', 'Artha', 'Kama', 'Moksha'];
            
            jaiminiContent.innerHTML = `
                <div class="jaimini-item">
                    <div class="jaimini-label">Atmakaraka (Soul Significator)</div>
                    <div class="jaimini-value">${planets[jaiminiFactors.atmakaraka]}</div>
                    <div class="jaimini-description">
                        Your soul's primary desire in this incarnation is represented by ${planets[jaiminiFactors.atmakaraka]}. 
                        This planet reveals your deepest karmic lessons and the main theme of your spiritual journey.
                    </div>
                </div>
                
                <div class="jaimini-item">
                    <div class="jaimini-label">Arudha Lagna (External Persona)</div>
                    <div class="jaimini-value">${houses[jaiminiFactors.arudhaLagna]}</div>
                    <div class="jaimini-description">
                        The world perceives you through the lens of ${houses[jaiminiFactors.arudhaLagna]}. 
                        This is the mask your soul has chosen to navigate this incarnation's lessons.
                    </div>
                </div>
                
                <div class="jaimini-item">
                    <div class="jaimini-label">Karmic Theme</div>
                    <div class="jaimini-value">${karmicThemes[jaiminiFactors.atmakaraka % 4]}</div>
                    <div class="jaimini-description">
                        Your primary life path focuses on ${getKarmicDescription(karmicThemes[jaiminiFactors.atmakaraka % 4])}. 
                        This theme colors all your experiences and relationships in this lifetime.
                    </div>
                </div>
                
                <div class="jaimini-item">
                    <div class="jaimini-label">Spiritual Maturity Score</div>
                    <div class="jaimini-value">${jaiminiFactors.spiritualMaturity}/150</div>
                    <div class="jaimini-description">
                        Your Jaimini chart indicates a spiritual maturity level that added ${jaiminiFactors.refinementBonus} incarnations 
                        to your base calculation, reflecting accumulated wisdom from past lives.
                    </div>
                </div>
            `;
            
            resultContainer.classList.add('show');
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function getKarmicDescription(theme) {
            const descriptions = {
                'Dharma': 'righteous living, moral duty, and aligning with your higher purpose',
                'Artha': 'material success, security, and creating a stable foundation for spiritual growth',
                'Kama': 'desires, emotional fulfillment, and understanding the nature of attachment',
                'Moksha': 'liberation, spiritual freedom, and transcendence of the ego'
            };
            return descriptions[theme] || 'spiritual evolution';
        }

        // Click outside to close dropdown
        document.addEventListener('click', function(event) {
            const locationInput = document.getElementById('birthLocation');
            const dropdown = document.getElementById('locationAutocomplete');
            
            if (locationInput && dropdown) {
                if (!locationInput.contains(event.target) && !dropdown.contains(event.target)) {
                    hideLocationDropdown();
                }
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set max date to today
            const dateInput = document.getElementById('birthDate');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.max = today;
                
                // Set min date to 150 years ago
                const minDate = new Date();
                minDate.setFullYear(minDate.getFullYear() - 150);
                dateInput.min = minDate.toISOString().split('T')[0];
            }
            
            // Initial validation
            validateForm();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Age Calculator - 777 Incarnation Journey</title>
    <style>
        /* CSS Variables */
        :root {
            --primary: #8B5CF6;
            --secondary: #EC4899;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-light: #F3F4F6;
            --bg-white: #FFFFFF;
            --text: #1F2937;
            --text-light: #6B7280;
            --border: #E5E7EB;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #10B981;
            --error: #EF4444;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px var(--shadow);
        }

        .header h1 {
            font-size: 3.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #6B7280;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .privacy-notice {
            display: inline-block;
            background: #10B98120;
            color: #065F46;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Tabs Navigation */
        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 25px var(--shadow);
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6B7280;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #F3F4F6;
        }

        .tab-btn.active {
            background: var(--gradient);
            color: white;
            border-color: transparent;
        }

        .tab-icon {
            font-size: 1.2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sections */
        .section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-light);
        }

        .section-icon {
            font-size: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-title {
            font-size: 1.8rem;
            color: var(--text);
            font-weight: 700;
        }

        /* Form Styles */
        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .time-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .location-input-container {
            position: relative;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: #f9fafb;
        }

        .location-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .location-details {
            font-size: 0.9em;
            color: #6b7280;
        }

        .search-status {
            padding: 20px;
            text-align: center;
            color: #6b7280;
        }

        .search-status.loading {
            color: #667eea;
            font-weight: 500;
        }

        .validation-icon {
            position: absolute;
            right: 15px;
            top: 45px;
            font-size: 1.2em;
            display: none;
        }

        .validation-icon.valid {
            color: #10b981;
            display: inline;
        }

        .validation-icon.invalid {
            color: #ef4444;
            display: inline;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .unknown-time-btn {
            padding: 10px 20px;
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .unknown-time-btn:hover {
            background: #e5e7eb;
        }

        /* Survey Grid */
        .survey-grid {
            display: grid;
            gap: 20px;
        }

        .question-card {
            background: #F9FAFB;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text);
        }

        /* Wisdom Cards */
        .wisdom-card {
            background: linear-gradient(135deg, #F3E7FC 0%, #E9D5FF 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #DDD6FE;
        }

        .wisdom-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6B21A8;
            margin-bottom: 15px;
        }

        /* Button */
        .calculate-btn {
            background: var(--gradient);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .calculate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        .calculate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results */
        .result-card {
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            display: none;
        }

        .result-card.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .soul-age-number {
            font-size: 4rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        /* FAQ */
        .faq-section {
            margin-top: 20px;
        }

        .faq-category {
            margin-bottom: 30px;
        }

        .faq-category-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .faq-item {
            margin-bottom: 15px;
            background: #F9FAFB;
            border-radius: 12px;
            overflow: hidden;
        }

        .faq-question {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .faq-question:hover {
            background: #F3F4F6;
        }

        .faq-toggle {
            transition: transform 0.3s ease;
        }

        .faq-toggle.rotated {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            color: var(--text-light);
        }

        .faq-answer.show {
            padding: 0 20px 20px;
            max-height: 500px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .tabs-nav {
                flex-direction: column;
            }
            
            .time-grid {
                grid-template-columns: 1fr;
            }
            
            .soul-age-number {
                font-size: 3rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üïâÔ∏è Soul Age Calculator</h1>
            <p class="subtitle">Discover Your Position in the 777-Incarnation Journey</p>
            <p style="color: #6B7280; font-size: 0.95rem;">
                Based on Ancient Vedantic Wisdom & Theosophical Teachings
            </p>
            <div class="privacy-notice">
                üîí Completely Private - No Data Stored
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchTab('calculator-tab', this)">
                <span class="tab-icon">üßÆ</span>
                Calculator
            </button>
            <button class="tab-btn" onclick="switchTab('understanding-tab', this)">
                <span class="tab-icon">üïâÔ∏è</span>
                Understanding
            </button>
            <button class="tab-btn" onclick="switchTab('jaimini-tab', this)">
                <span class="tab-icon">üîÆ</span>
                Jaimini Analysis
            </button>
            <button class="tab-btn" onclick="switchTab('faq-tab', this)">
                <span class="tab-icon">‚ùì</span>
                FAQ
            </button>
        </div>

        <!-- Tab 1: Calculator -->
        <div id="calculator-tab" class="tab-content active">
            <!-- Birth Information -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">‚≠ê</span>
                    <h2 class="section-title">Birth Information</h2>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Birth Date *</label>
                    <input type="date" 
                           id="birthDate" 
                           class="input-field" 
                           oninput="handleDateValidation()"
                           required>
                    <span id="dateValidation" class="validation-icon">‚úì</span>
                    <div id="dateError" class="error-message"></div>
                </div>

                <div class="input-group">
                    <label class="input-label">Birth Time (Optional)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="time-grid">
                            <select id="birthHour" class="input-field" onchange="handleTimeValidation()">
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="birthMinute" class="input-field" onchange="handleTimeValidation()">
                                <option value="0">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="ampm" class="input-field" onchange="handleTimeValidation()">
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        <button type="button" class="unknown-time-btn" onclick="useUnknownTime()">
                            Don't Know Time
                        </button>
                    </div>
                    <span id="timeValidation" class="validation-icon">‚úì</span>
                    <div id="timeError" class="error-message"></div>
                </div>

                <div class="input-group">
                    <label class="input-label">Birth Location *</label>
                    <div class="location-input-container">
                        <input type="text" 
                               id="birthLocation" 
                               class="input-field" 
                               placeholder="Start typing city name (min 3 letters)..."
                               oninput="searchLocation()"
                               autocomplete="off"
                               required>
                        <div id="locationAutocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <span id="locationValidation" class="validation-icon">‚úì</span>
                    <div id="locationError" class="error-message"></div>
                </div>
            </div>

            <!-- Why Answer Authentically Section -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üéØ</span>
                    <h2 class="section-title">Why Answer These Questions Authentically?</h2>
                </div>
                
                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>‚öñÔ∏è</span>
                        <span>Your Answers Directly Impact Your Soul Age Calculation</span>
                    </div>
                    <p style="line-height: 1.8; color: #4B5563; margin-bottom: 15px;">
                        Each question can shift your calculated soul age by <strong>hundreds of incarnations</strong> because they measure your current <strong>level of consciousness</strong> - which in spiritual traditions matters more than chronological experience. 
                    </p>
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <p style="color: #059669; font-weight: 600; margin: 0;">
                            üí° Being honest reveals your true spiritual position - there's profound wisdom in every stage.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Soul Insights Survey -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üßø</span>
                    <h2 class="section-title">Soul Insights Survey</h2>
                </div>
                <p style="color: #6B7280; margin-bottom: 20px;">
                    These questions help refine your soul age calculation by understanding your current life patterns and spiritual inclinations.
                </p>

                <div class="survey-grid">
                    <div class="question-card">
                        <div class="question-text">1. What drives you most in life?</div>
                        <select id="q1" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="survival">Basic survival, security, and material needs</option>
                            <option value="pleasure">Pleasure, excitement, and new experiences</option>
                            <option value="success">Success, achievement, and recognition</option>
                            <option value="relationships">Deep relationships and emotional connections</option>
                            <option value="meaning">Meaning, wisdom, and spiritual growth</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">2. How do you typically handle conflict?</div>
                        <select id="q2" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="avoid">Avoid it at all costs</option>
                            <option value="fight">Fight aggressively to win</option>
                            <option value="compete">Compete strategically</option>
                            <option value="understand">Seek to understand all perspectives</option>
                            <option value="transcend">Find ways to transcend the conflict entirely</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">3. How important are material possessions to you?</div>
                        <select id="q3" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="essential">Essential for my security and identity</option>
                            <option value="enjoy">I enjoy them but don't need them</option>
                            <option value="status">They represent my achievements</option>
                            <option value="tools">They're tools for experiences</option>
                            <option value="burden">They can be a burden to spiritual growth</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">4. How do you prefer to learn?</div>
                        <select id="q4" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="repetition">Through repetition and clear rules</option>
                            <option value="experience">Through direct experience</option>
                            <option value="systems">Through systems and strategies</option>
                            <option value="reflection">Through deep reflection</option>
                            <option value="intuition">Through intuition and inner knowing</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">5. What's your attitude toward change?</div>
                        <select id="q5" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="resist">I resist it and prefer stability</option>
                            <option value="excitement">It excites me as adventure</option>
                            <option value="opportunity">I see it as opportunity for growth</option>
                            <option value="natural">I accept it as natural</option>
                            <option value="catalyst">I embrace it as spiritual catalyst</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">6. When facing suffering or disappointment, what is your first response?</div>
                        <select id="q6" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="blame">Blame others or external circumstances</option>
                            <option value="resist">Fight against it or deny its reality</option>
                            <option value="accept">Accept it but feel victimized by life</option>
                            <option value="lesson">See it as a lesson and opportunity for growth</option>
                            <option value="witness">Observe it with detachment as part of life's play</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">7. How do you experience your sense of individual identity?</div>
                        <select id="q7" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="physical">I am primarily this body and its needs</option>
                            <option value="social">I am defined by my roles, relationships, and reputation</option>
                            <option value="achiever">I am what I accomplish and create in the world</option>
                            <option value="seeker">I am a soul having experiences and learning</option>
                            <option value="awareness">I am awareness itself, temporarily in form</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">8. What is your relationship with rules, traditions, and authority?</div>
                        <select id="q8" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="depend">I need clear rules and authority to feel safe</option>
                            <option value="follow">I generally follow them to maintain order</option>
                            <option value="challenge">I challenge them to create my own path</option>
                            <option value="discern">I discern which serve growth and which don't</option>
                            <option value="beyond">I see them as constructs that don't define me</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">9. How do you perceive time and your life journey?</div>
                        <select id="q9" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="day">I focus on getting through each day</option>
                            <option value="linear">Life is a linear path from birth to death</option>
                            <option value="building">I'm building toward future goals</option>
                            <option value="cycles">Life moves in cycles and patterns</option>
                            <option value="eternal">This life is one brief moment in eternity</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">10. What motivates your major life decisions?</div>
                        <select id="q10" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="safety">Safety and security needs</option>
                            <option value="duty">Duty to family and society</option>
                            <option value="achievement">Personal achievement and success</option>
                            <option value="authentic">Authentic self-expression</option>
                            <option value="service">Service to humanity's evolution</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">11. How do you view romantic relationships?</div>
                        <select id="q11" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="fear">Something I fear or avoid</option>
                            <option value="separate">Two separate people meeting needs</option>
                            <option value="partner">Partnership for building a life</option>
                            <option value="love">Deep soul connection and growth</option>
                            <option value="self">Mirror for self-discovery</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">12. What is your primary source of wisdom?</div>
                        <select id="q12" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="experience">Direct physical experience</option>
                            <option value="tradition">Traditional teachings and elders</option>
                            <option value="analysis">Logic and analytical thinking</option>
                            <option value="insight">Emotional insights and empathy</option>
                            <option value="intuition">Inner knowing and intuition</option>
                        </select>
                    </div>

                    <div class="question-card">
                        <div class="question-text">13. How do you relate to humanity as a whole?</div>
                        <select id="q13" class="input-field" onchange="handleSurveyValidation()">
                            <option value="">Select one...</option>
                            <option value="separate">Others are separate from me</option>
                            <option value="tribal">I belong to my group/tribe</option>
                            <option value="network">We're all connected in networks</option>
                            <option value="heart">I feel others' joys and pains</option>
                            <option value="unity">We are all one consciousness</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateSoulAge()" disabled>
                Calculate My Soul Age
            </button>

            <!-- Results Section -->
            <div id="soulAgeResult" class="result-card">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Your Soul Age</h3>
                <div class="soul-age-number" id="soulAgeNumber">‚Äî</div>
                <div id="soulAgeStage" style="font-size: 1.5rem; color: var(--secondary); margin-bottom: 20px;"></div>
                <p id="soulAgeDescription" style="color: var(--text-light); line-height: 1.8;"></p>
            </div>
        </div>

        <!-- Tab 2: Understanding -->
        <div id="understanding-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üìö</span>
                    <h2 class="section-title">Understanding Soul Ages</h2>
                </div>
                <p style="color: #6B7280; margin-bottom: 30px;">
                    According to ancient wisdom traditions, souls evolve through 777 human incarnations, grouped into five major stages of consciousness evolution.
                </p>

                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>üë∂</span>
                        <span>Infant Soul (1-155 incarnations)</span>
                    </div>
                    <p>Learning basic survival, understanding physical reality, and developing fundamental human skills.</p>
                </div>

                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>üßí</span>
                        <span>Baby Soul (156-310 incarnations)</span>
                    </div>
                    <p>Understanding structure, rules, right and wrong, and learning to function within society.</p>
                </div>

                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>üíº</span>
                        <span>Young Soul (311-465 incarnations)</span>
                    </div>
                    <p>Focused on achievement, success, independence, and making their mark on the world.</p>
                </div>

                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>‚ù§Ô∏è</span>
                        <span>Mature Soul (466-620 incarnations)</span>
                    </div>
                    <p>Exploring emotional depth, authentic relationships, and understanding different perspectives.</p>
                </div>

                <div class="wisdom-card">
                    <div class="wisdom-header">
                        <span>üßô</span>
                        <span>Old Soul (621-777 incarnations)</span>
                    </div>
                    <p>Seeking spiritual truth, wisdom, and finding ways to serve humanity's evolution.</p>
                </div>
            </div>
        </div>

        <!-- Tab 3: Jaimini Analysis -->
        <div id="jaimini-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üîÆ</span>
                    <h2 class="section-title">Jaimini Astrological Analysis</h2>
                </div>
                <p style="color: #6B7280; margin-bottom: 20px;">
                    The Jaimini system reveals your soul's karmic patterns through special planetary calculations.
                </p>

                <div class="input-group">
                    <label class="input-label">Birth Date *</label>
                    <input type="date" 
                           id="jaiminiBirthDate" 
                           class="input-field" 
                           oninput="handleJaiminiDateValidation()"
                           required>
                    <span id="jaiminiDateValidation" class="validation-icon">‚úì</span>
                    <div id="jaiminiDateError" class="error-message"></div>
                </div>

                <div class="input-group">
                    <label class="input-label">Birth Time *</label>
                    <div class="time-grid">
                        <select id="jaiminiBirthHour" class="input-field" onchange="handleJaiminiTimeValidation()">
                            <option value="">Hour</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <select id="jaiminiBirthMinute" class="input-field" onchange="handleJaiminiTimeValidation()">
                            <option value="0">00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                        <select id="jaiminiAmpm" class="input-field" onchange="handleJaiminiTimeValidation()">
                            <option value="">AM/PM</option>
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                    <span id="jaiminiTimeValidation" class="validation-icon">‚úì</span>
                    <div id="jaiminiTimeError" class="error-message"></div>
                </div>

                <div class="input-group">
                    <label class="input-label">Birth Location *</label>
                    <div class="location-input-container">
                        <input type="text" 
                               id="jaiminiBirthLocation" 
                               class="input-field" 
                               placeholder="Start typing city name (min 3 letters)..."
                               oninput="searchJaiminiLocation()"
                               autocomplete="off"
                               required>
                        <div id="jaiminiLocationAutocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <span id="jaiminiLocationValidation" class="validation-icon">‚úì</span>
                    <div id="jaiminiLocationError" class="error-message"></div>
                </div>

                <button class="calculate-btn" onclick="calculateJaiminiChart()" disabled>
                    Calculate Jaimini Chart
                </button>

                <!-- Jaimini Results -->
                <div id="jaiminiResult" class="result-card">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Your Jaimini Analysis</h3>
                    <div id="jaiminiContent"></div>
                </div>
            </div>
        </div>

        <!-- Tab 4: FAQ -->
        <div id="faq-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">‚ùì</span>
                    <h2 class="section-title">Frequently Asked Questions</h2>
                </div>
                <p style="color: #6B7280; margin-bottom: 30px;">
                    Here are the most common questions people ask about soul age and this calculator.
                </p>

                <div class="faq-section">
                    <div class="faq-category">
                        <h3 class="faq-category-title">
                            <span>üåü</span>
                            Basic Concepts
                        </h3>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                What exactly is a "soul age"?
                                <span class="faq-toggle">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                Soul age refers to how many lifetimes your soul has experienced as a human being on Earth. It's like asking "what grade are you in?" at the school of human experience.
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                Is this compatible with my religious beliefs?
                                <span class="faq-toggle">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                This calculator is based on Eastern spiritual concepts that may or may not align with your religious beliefs. Use this tool only if it feels helpful and doesn't conflict with your personal faith.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentLocationData = null;
        let currentJaiminiLocationData = null;
        let searchTimeout = null;
        let jaiminiSearchTimeout = null;
        let searchController = null;
        let jaiminiSearchController = null;

        // Validation functions
        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.add('show');
            }
        }

        function hideError(elementId) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.classList.remove('show');
            }
        }

        function showValidation(elementId, isValid) {
            const validationEl = document.getElementById(elementId);
            if (validationEl) {
                validationEl.classList.remove('valid', 'invalid');
                validationEl.classList.add(isValid ? 'valid' : 'invalid');
                validationEl.textContent = isValid ? '‚úì' : '‚úó';
            }
        }

        // Main Calculator Tab Validation
        function validateDate() {
            const input = document.getElementById('birthDate');
            const dateValue = input.value;
            
            if (!dateValue) {
                showError('dateError', 'Birth date is required');
                showValidation('dateValidation', false);
                return false;
            }
            
            const date = new Date(dateValue);
            
            if (isNaN(date.getTime())) {
                showError('dateError', 'Please enter a valid date');
                showValidation('dateValidation', false);
                return false;
            }
            
            const now = new Date();
            const minDate = new Date(now.getFullYear() - 150, 0, 1);
            
            if (date > now) {
                showError('dateError', 'Birth date cannot be in the future');
                showValidation('dateValidation', false);
                return false;
            }
            
            if (date < minDate) {
                showError('dateError', 'Birth date seems too far in the past');
                showValidation('dateValidation', false);
                return false;
            }
            
            hideError('dateError');
            showValidation('dateValidation', true);
            return true;
        }

        function validateTime() {
            const hour = document.getElementById('birthHour').value;
            const minute = document.getElementById('birthMinute').value || '0';
            const ampm = document.getElementById('ampm').value;
            
            // Time is optional
            if (!hour && !ampm) {
                showValidation('timeValidation', true);
                hideError('timeError');
                return true;
            }
            
            if (hour && !ampm) {
                showError('timeError', 'Please select AM or PM');
                showValidation('timeValidation', false);
                return false;
            }
            
            if (!hour && ampm) {
                showError('timeError', 'Please select an hour');
                showValidation('timeValidation', false);
                return false;
            }
            
            const hourNum = parseInt(hour);
            const minuteNum = parseInt(minute);
            
            if (hourNum < 1 || hourNum > 12) {
                showError('timeError', 'Hour must be between 1 and 12');
                showValidation('timeValidation', false);
                return false;
            }
            
            if (minuteNum < 0 || minuteNum > 59) {
                showError('timeError', 'Minutes must be between 0 and 59');
                showValidation('timeValidation', false);
                return false;
            }
            
            hideError('timeError');
            showValidation('timeValidation', true);
            return true;
        }

        function validateLocation() {
            const input = document.getElementById('birthLocation');
            
            if (!input.value.trim()) {
                showError('locationError', 'Birth location is required');
                showValidation('locationValidation', false);
                return false;
            }
            
            if (!currentLocationData) {
                showError('locationError', 'Please select a location from the dropdown');
                showValidation('locationValidation', false);
                return false;
            }
            
            hideError('locationError');
            showValidation('locationValidation', true);
            return true;
        }

        // Handler functions to prevent infinite recursion
        function handleDateValidation() {
            validateDate();
            validateForm();
        }

        function handleTimeValidation() {
            validateTime();
            validateForm();
        }

        function handleSurveyValidation() {
            validateForm();
        }

        function useUnknownTime() {
            document.getElementById('birthHour').value = '12';
            document.getElementById('birthMinute').value = '0';
            document.getElementById('ampm').value = 'PM';
            handleTimeValidation();
        }

        function validateForm() {
            const dateValid = validateDate();
            const timeValid = validateTime();
            const locationValid = validateLocation();
            
            // Check survey questions - all 13 questions
            const surveyValid = ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13'].every(id => {
                const element = document.getElementById(id);
                return element && element.value !== '';
            });
            
            const allValid = dateValid && timeValid && locationValid && surveyValid;
            
            // Enable/disable calculate button
            const calculateBtn = document.querySelector('button[onclick="calculateSoulAge()"]');
            if (calculateBtn) calculateBtn.disabled = !allValid;
            
            return allValid;
        }

        // Jaimini Tab Validation Functions
        function validateJaiminiDate() {
            const input = document.getElementById('jaiminiBirthDate');
            const dateValue = input.value;
            
            if (!dateValue) {
                showError('jaiminiDateError', 'Birth date is required');
                showValidation('jaiminiDateValidation', false);
                return false;
            }
            
            const date = new Date(dateValue);
            
            if (isNaN(date.getTime())) {
                showError('jaiminiDateError', 'Please enter a valid date');
                showValidation('jaiminiDateValidation', false);
                return false;
            }
            
            const now = new Date();
            const minDate = new Date(now.getFullYear() - 150, 0, 1);
            
            if (date > now) {
                showError('jaiminiDateError', 'Birth date cannot be in the future');
                showValidation('jaiminiDateValidation', false);
                return false;
            }
            
            if (date < minDate) {
                showError('jaiminiDateError', 'Birth date seems too far in the past');
                showValidation('jaiminiDateValidation', false);
                return false;
            }
            
            hideError('jaiminiDateError');
            showValidation('jaiminiDateValidation', true);
            return true;
        }

        function validateJaiminiTime() {
            const hour = document.getElementById('jaiminiBirthHour').value;
            const minute = document.getElementById('jaiminiBirthMinute').value || '0';
            const ampm = document.getElementById('jaiminiAmpm').value;
            
            // Time is required for Jaimini
            if (!hour || !ampm) {
                showError('jaiminiTimeError', 'Complete time is required for Jaimini analysis');
                showValidation('jaiminiTimeValidation', false);
                return false;
            }
            
            const hourNum = parseInt(hour);
            const minuteNum = parseInt(minute);
            
            if (hourNum < 1 || hourNum > 12) {
                showError('jaiminiTimeError', 'Hour must be between 1 and 12');
                showValidation('jaiminiTimeValidation', false);
                return false;
            }
            
            if (minuteNum < 0 || minuteNum > 59) {
                showError('jaiminiTimeError', 'Minutes must be between 0 and 59');
                showValidation('jaiminiTimeValidation', false);
                return false;
            }
            
            hideError('jaiminiTimeError');
            showValidation('jaiminiTimeValidation', true);
            return true;
        }

        function validateJaiminiLocation() {
            const input = document.getElementById('jaiminiBirthLocation');
            
            if (!input.value.trim()) {
                showError('jaiminiLocationError', 'Birth location is required');
                showValidation('jaiminiLocationValidation', false);
                return false;
            }
            
            if (!currentJaiminiLocationData) {
                showError('jaiminiLocationError', 'Please select a location from the dropdown');
                showValidation('jaiminiLocationValidation', false);
                return false;
            }
            
            hideError('jaiminiLocationError');
            showValidation('jaiminiLocationValidation', true);
            return true;
        }

        // Jaimini handler functions
        function handleJaiminiDateValidation() {
            validateJaiminiDate();
            validateJaiminiForm();
        }

        function handleJaiminiTimeValidation() {
            validateJaiminiTime();
            validateJaiminiForm();
        }

        function validateJaiminiForm() {
            const dateValid = validateJaiminiDate();
            const timeValid = validateJaiminiTime();
            const locationValid = validateJaiminiLocation();
            
            const allValid = dateValid && timeValid && locationValid;
            
            // Enable/disable calculate button
            const calculateBtn = document.querySelector('button[onclick="calculateJaiminiChart()"]');
            if (calculateBtn) calculateBtn.disabled = !allValid;
            
            return allValid;
        }

        // Location search functionality for Calculator tab
        function searchLocation() {
            const query = document.getElementById('birthLocation').value.trim();
            
            // Clear current location data when input changes
            currentLocationData = null;
            validateLocation();
            validateForm();
            
            if (query.length < 3) {
                hideLocationDropdown();
                return;
            }
            
            // Cancel previous search
            if (searchController) {
                searchController.abort();
            }
            
            // Clear previous timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            // Debounce the search
            searchTimeout = setTimeout(() => {
                performLocationSearch(query);
            }, 300);
        }

        async function performLocationSearch(query) {
            const dropdown = document.getElementById('locationAutocomplete');
            
            try {
                searchController = new AbortController();
                
                dropdown.innerHTML = '<div class="search-status loading">üîç Searching...</div>';
                dropdown.style.display = 'block';
                
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&limit=8&addressdetails=1&q=${encodeURIComponent(query)}`,
                    {
                        signal: searchController.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const locations = await response.json();
                
                if (locations.length === 0) {
                    dropdown.innerHTML = '<div class="search-status">No locations found. Try typing a city name.</div>';
                    return;
                }
                
                displayLocationResults(locations);
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    return;
                }
                console.error('Location search error:', error);
                dropdown.innerHTML = '<div class="search-status">Search unavailable. You can still type a location name.</div>';
            }
        }

        function displayLocationResults(locations) {
            const dropdown = document.getElementById('locationAutocomplete');
            
            const html = locations.map(location => {
                const displayName = escapeHtml(location.display_name);
                const shortName = displayName.split(',')[0];
                
                const safeData = {
                    name: escapeHtml(location.display_name),
                    lat: parseFloat(location.lat),
                    lon: parseFloat(location.lon)
                };
                
                return `
                    <div class="autocomplete-item" 
                         data-location='${JSON.stringify(safeData)}'>
                        <div class="location-name">${shortName}</div>
                        <div class="location-details">${displayName}</div>
                    </div>
                `;
            }).join('');
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
            
            // Add click handlers
            dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                item.addEventListener('click', function() {
                    const locationData = JSON.parse(this.dataset.location);
                    selectLocation(locationData.name, locationData.lat, locationData.lon);
                });
            });
        }

        function selectLocation(name, lat, lon) {
            document.getElementById('birthLocation').value = name;
            currentLocationData = { name, lat, lon };
            hideLocationDropdown();
            validateLocation();
            validateForm();
        }

        function hideLocationDropdown() {
            const dropdown = document.getElementById('locationAutocomplete');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }

        // Location search functionality for Jaimini tab
        function searchJaiminiLocation() {
            const query = document.getElementById('jaiminiBirthLocation').value.trim();
            
            // Clear current location data when input changes
            currentJaiminiLocationData = null;
            validateJaiminiLocation();
            validateJaiminiForm();
            
            if (query.length < 3) {
                hideJaiminiLocationDropdown();
                return;
            }
            
            // Cancel previous search
            if (jaiminiSearchController) {
                jaiminiSearchController.abort();
            }
            
            // Clear previous timeout
            if (jaiminiSearchTimeout) {
                clearTimeout(jaiminiSearchTimeout);
            }
            
            // Debounce the search
            jaiminiSearchTimeout = setTimeout(() => {
                performJaiminiLocationSearch(query);
            }, 300);
        }

        async function performJaiminiLocationSearch(query) {
            const dropdown = document.getElementById('jaiminiLocationAutocomplete');
            
            try {
                jaiminiSearchController = new AbortController();
                
                dropdown.innerHTML = '<div class="search-status loading">üîç Searching...</div>';
                dropdown.style.display = 'block';
                
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&limit=8&addressdetails=1&q=${encodeURIComponent(query)}`,
                    {
                        signal: jaiminiSearchController.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const locations = await response.json();
                
                if (locations.length === 0) {
                    dropdown.innerHTML = '<div class="search-status">No locations found. Try typing a city name.</div>';
                    return;
                }
                
                displayJaiminiLocationResults(locations);
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    return;
                }
                console.error('Jaimini location search error:', error);
                dropdown.innerHTML = '<div class="search-status">Search unavailable. You can still type a location name.</div>';
            }
        }

        function displayJaiminiLocationResults(locations) {
            const dropdown = document.getElementById('jaiminiLocationAutocomplete');
            
            const html = locations.map(location => {
                const displayName = escapeHtml(location.display_name);
                const shortName = displayName.split(',')[0];
                
                const safeData = {
                    name: escapeHtml(location.display_name),
                    lat: parseFloat(location.lat),
                    lon: parseFloat(location.lon)
                };
                
                return `
                    <div class="autocomplete-item" 
                         data-location='${JSON.stringify(safeData)}'>
                        <div class="location-name">${shortName}</div>
                        <div class="location-details">${displayName}</div>
                    </div>
                `;
            }).join('');
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
            
            // Add click handlers
            dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                item.addEventListener('click', function() {
                    const locationData = JSON.parse(this.dataset.location);
                    selectJaiminiLocation(locationData.name, locationData.lat, locationData.lon);
                });
            });
        }

        function selectJaiminiLocation(name, lat, lon) {
            document.getElementById('jaiminiBirthLocation').value = name;
            currentJaiminiLocationData = { name, lat, lon };
            hideJaiminiLocationDropdown();
            validateJaiminiLocation();
            validateJaiminiForm();
        }

        function hideJaiminiLocationDropdown() {
            const dropdown = document.getElementById('jaiminiLocationAutocomplete');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }

        // Utility function to escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Tab switching
        function switchTab(tabId, buttonEl) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabId).classList.add('active');
            buttonEl.classList.add('active');
        }

        // FAQ functionality
        function toggleFaq(questionElement) {
            const answer = questionElement.nextElementSibling;
            const toggle = questionElement.querySelector('.faq-toggle');
            
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                toggle.classList.remove('rotated');
            } else {
                // Close all other FAQs
                document.querySelectorAll('.faq-answer.show').forEach(openAnswer => {
                    openAnswer.classList.remove('show');
                    openAnswer.previousElementSibling.querySelector('.faq-toggle').classList.remove('rotated');
                });
                
                // Open this FAQ
                answer.classList.add('show');
                toggle.classList.add('rotated');
            }
        }

        // Calculate Soul Age
        function calculateSoulAge() {
            if (!validateForm()) {
                alert('Please fill in all required fields correctly.');
                return;
            }
            
            // Get birth date
            const birthDate = new Date(document.getElementById('birthDate').value);
            
            // Get survey responses
            const surveyResponses = {};
            ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13'].forEach(id => {
                surveyResponses[id] = document.getElementById(id).value;
            });
            
            // Calculate base soul age
            const baseAge = calculateBaseSoulAge(birthDate, surveyResponses);
            
            // Determine soul stage
            const soulStage = determineSoulStage(baseAge);
            
            // Display results
            const resultCard = document.getElementById('soulAgeResult');
            const soulAgeNumber = document.getElementById('soulAgeNumber');
            const soulAgeStageEl = document.getElementById('soulAgeStage');
            const soulAgeDescription = document.getElementById('soulAgeDescription');
            
            soulAgeNumber.textContent = `${baseAge} incarnations`;
            soulAgeStageEl.textContent = soulStage.name;
            soulAgeDescription.textContent = soulStage.description;
            
            resultCard.classList.add('show');
            resultCard.scrollIntoView({ behavior: 'smooth' });
        }

        function calculateBaseSoulAge(birthDate, responses) {
            // Base calculation from birth date
            const dayOfYear = Math.floor((birthDate - new Date(birthDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            let baseAge = dayOfYear;
            
            // Add survey adjustments
            const adjustment = calculateSurveyAdjustment(responses);
            baseAge += adjustment;
            
            // Normalize to 1-777 range
            baseAge = Math.abs(baseAge) % 777;
            if (baseAge === 0) baseAge = 1;
            
            return baseAge;
        }

        function calculateSurveyAdjustment(responses) {
            let adjustment = 0;
            
            // Basic 5 questions
            const q1Map = { 'survival': -100, 'pleasure': -50, 'success': 0, 'relationships': 100, 'meaning': 200 };
            adjustment += q1Map[responses.q1] || 0;
            
            const q2Map = { 'avoid': -100, 'fight': -50, 'compete': 0, 'understand': 100, 'transcend': 200 };
            adjustment += q2Map[responses.q2] || 0;
            
            const q3Map = { 'essential': -100, 'enjoy': -50, 'status': 0, 'tools': 100, 'burden': 200 };
            adjustment += q3Map[responses.q3] || 0;
            
            const q4Map = { 'repetition': -100, 'experience': -50, 'systems': 0, 'reflection': 100, 'intuition': 200 };
            adjustment += q4Map[responses.q4] || 0;
            
            const q5Map = { 'resist': -100, 'excitement': -50, 'opportunity': 0, 'natural': 100, 'catalyst': 200 };
            adjustment += q5Map[responses.q5] || 0;
            
            // Advanced 8 questions
            const q6Map = { 'blame': -80, 'resist': -40, 'accept': 0, 'lesson': 80, 'witness': 160 };
            adjustment += q6Map[responses.q6] || 0;
            
            const q7Map = { 'physical': -80, 'social': -40, 'achiever': 0, 'seeker': 80, 'awareness': 160 };
            adjustment += q7Map[responses.q7] || 0;
            
            const q8Map = { 'depend': -80, 'follow': -40, 'challenge': 0, 'discern': 80, 'beyond': 160 };
            adjustment += q8Map[responses.q8] || 0;
            
            const q9Map = { 'day': -80, 'linear': -40, 'building': 0, 'cycles': 80, 'eternal': 160 };
            adjustment += q9Map[responses.q9] || 0;
            
            const q10Map = { 'safety': -80, 'duty': -40, 'achievement': 0, 'authentic': 80, 'service': 160 };
            adjustment += q10Map[responses.q10] || 0;
            
            const q11Map = { 'fear': -80, 'separate': -40, 'partner': 0, 'love': 80, 'self': 160 };
            adjustment += q11Map[responses.q11] || 0;
            
            const q12Map = { 'experience': -80, 'tradition': -40, 'analysis': 0, 'insight': 80, 'intuition': 160 };
            adjustment += q12Map[responses.q12] || 0;
            
            const q13Map = { 'separate': -80, 'tribal': -40, 'network': 0, 'heart': 80, 'unity': 160 };
            adjustment += q13Map[responses.q13] || 0;
            
            return adjustment;
        }

        function determineSoulStage(soulAge) {
            if (soulAge <= 155) {
                return {
                    name: 'Infant Soul',
                    description: 'You are in the early stages of human experience, learning basic survival and how to exist in a physical body. This is a beautiful time of discovering the physical world.',
                    range: [1, 155]
                };
            } else if (soulAge <= 310) {
                return {
                    name: 'Baby Soul',
                    description: 'You are learning structure, rules, and how to belong to groups and communities. This stage focuses on understanding right and wrong and finding your place in society.',
                    range: [156, 310]
                };
            } else if (soulAge <= 465) {
                return {
                    name: 'Young Soul',
                    description: 'You are focused on achievement, success, and making your mark in the world. This is a time of ambition, independence, and material mastery.',
                    range: [311, 465]
                };
            } else if (soulAge <= 620) {
                return {
                    name: 'Mature Soul',
                    description: 'You are exploring emotional depth, relationships, and authentic self-expression. This stage brings intensity, self-reflection, and deep connections with others.',
                    range: [466, 620]
                };
            } else {
                return {
                    name: 'Old Soul',
                    description: 'You are seeking wisdom, spiritual truth, and ways to serve humanity\'s evolution. This final stage brings detachment, acceptance, and a focus on the bigger picture.',
                    range: [621, 777]
                };
            }
        }

        // Calculate Jaimini Chart
        function calculateJaiminiChart() {
            if (!validateJaiminiForm()) {
                alert('Please fill in all required fields for Jaimini analysis.');
                return;
            }
            
            // Get birth information
            const birthDate = new Date(document.getElementById('jaiminiBirthDate').value);
            const hour = parseInt(document.getElementById('jaiminiBirthHour').value);
            const minute = parseInt(document.getElementById('jaiminiBirthMinute').value);
            const ampm = document.getElementById('jaiminiAmpm').value;
            
            // Convert to 24-hour format
            let hour24 = hour;
            if (ampm === 'PM' && hour !== 12) hour24 += 12;
            if (ampm === 'AM' && hour === 12) hour24 = 0;
            
            // Mock Jaimini calculations
            const dayOfYear = Math.floor((birthDate - new Date(birthDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const hourOfDay = hour24 + minute / 60;
            
            const atmakaraka = (dayOfYear * 7 + hourOfDay) % 9;
            const arudhaLagna = (dayOfYear + hourOfDay * 15) % 12;
            
            const planets = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn', 'Rahu', 'Ketu'];
            const houses = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];
            const karmicThemes = ['Dharma', 'Artha', 'Kama', 'Moksha'];
            
            // Display results
            const resultCard = document.getElementById('jaiminiResult');
            const jaiminiContent = document.getElementById('jaiminiContent');
            
            jaiminiContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #8B5CF6; margin-bottom: 10px;">Atmakaraka (Soul Significator)</h4>
                    <p style="font-size: 1.2rem; color: #1F2937;"><strong>${planets[atmakaraka]}</strong></p>
                    <p style="color: #6B7280; line-height: 1.6;">Your Atmakaraka reveals your soul's primary desire and the main karmic lessons in this lifetime.</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #8B5CF6; margin-bottom: 10px;">Arudha Lagna (External Persona)</h4>
                    <p style="font-size: 1.2rem; color: #1F2937;"><strong>${houses[arudhaLagna]}</strong></p>
                    <p style="color: #6B7280; line-height: 1.6;">This shows how the world perceives you and your role in society.</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #8B5CF6; margin-bottom: 10px;">Karmic Theme</h4>
                    <p style="font-size: 1.2rem; color: #1F2937;"><strong>${karmicThemes[atmakaraka % 4]}</strong></p>
                    <p style="color: #6B7280; line-height: 1.6;">Your primary life path focuses on ${getKarmicDescription(karmicThemes[atmakaraka % 4])}</p>
                </div>
                
                <div style="background: #F3E7FC; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <p style="color: #6B21A8; font-style: italic; margin: 0;">
                        "Your soul's journey is guided by ${planets[atmakaraka]} through the lens of ${houses[arudhaLagna]}, 
                        teaching you about ${karmicThemes[atmakaraka % 4].toLowerCase()} in this incarnation."
                    </p>
                </div>
            `;
            
            resultCard.classList.add('show');
            resultCard.scrollIntoView({ behavior: 'smooth' });
        }

        function getKarmicDescription(theme) {
            const descriptions = {
                'Dharma': 'righteous living and spiritual duty',
                'Artha': 'material success and security',
                'Kama': 'desires and emotional fulfillment',
                'Moksha': 'liberation and spiritual freedom'
            };
            return descriptions[theme] || 'spiritual evolution';
        }

        // Click outside to close dropdowns
        document.addEventListener('click', function(event) {
            const locationInput = document.getElementById('birthLocation');
            const dropdown = document.getElementById('locationAutocomplete');
            const jaiminiLocationInput = document.getElementById('jaiminiBirthLocation');
            const jaiminiDropdown = document.getElementById('jaiminiLocationAutocomplete');
            
            if (locationInput && dropdown) {
                if (!locationInput.contains(event.target) && !dropdown.contains(event.target)) {
                    hideLocationDropdown();
                }
            }
            
            if (jaiminiLocationInput && jaiminiDropdown) {
                if (!jaiminiLocationInput.contains(event.target) && !jaiminiDropdown.contains(event.target)) {
                    hideJaiminiLocationDropdown();
                }
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set max date to today for date inputs
            const dateInputs = ['birthDate', 'jaiminiBirthDate'];
            const today = new Date().toISOString().split('T')[0];
            
            dateInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.max = today;
                    
                    // Set min date to 150 years ago
                    const minDate = new Date();
                    minDate.setFullYear(minDate.getFullYear() - 150);
                    input.min = minDate.toISOString().split('T')[0];
                }
            });
            
            // Initial validation
            validateForm();
            validateJaiminiForm();
        });
    </script>
</body>
</html>
